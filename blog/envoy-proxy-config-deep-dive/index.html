<!DOCTYPE html>
<html lang="zh">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Istio 的数据平面 Envoy Proxy 配置详解 · Service Mesh|服务网格中文社区</title>
  <meta name="author" content="Jimmy Song(宋净超)" />

  
  <meta name="keywords" content="service mesh, 服务网格, envoy">
  

  <meta name="generator" content="Hugo 0.55.5" />

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
  <link href="/css/style.violet.css" rel="stylesheet" id="theme-stylesheet">
  

  
  <link href="/css/custom.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/search.css" />

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

  
  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="ServiceMesher">

  
  <link rel="stylesheet" href="/css/prism.css" />

  
  <meta property="og:title" content="Istio 的数据平面 Envoy Proxy 配置详解" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/blog/envoy-proxy-config-deep-dive//" />
  <meta property="og:image" content="/img/servicemesher-avatar-banner.jpg" />
  <meta property="og:image:alt" content="ServiceMesher Logo" />

  
  <meta name="description" content="本文介绍了 Envoy proxy 的概念，对应的 xDS 的版本以及配置的详细解析。">
  <meta property="og:description" content="本文介绍了 Envoy proxy 的概念，对应的 xDS 的版本以及配置的详细解析。">
  <meta name="twitter:description" content="本文介绍了 Envoy proxy 的概念，对应的 xDS 的版本以及配置的详细解析。">
  <meta property="og:description" content="本文介绍了 Envoy proxy 的概念，对应的 xDS 的版本以及配置的详细解析。" />

  
  <meta name="referrer" content="never">

  
  
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?154337f0d95f0b110f98c1d5d7038895";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>


  
  

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/servicemesher-logo.jpg" alt="Istio 的数据平面 Envoy Proxy 配置详解 logo" class="hidden-xs hidden-sm">
                    <img src="/img/logosmall.jpg" alt="Istio 的数据平面 Envoy Proxy 配置详解 logo" class="visible-xs visible-sm">
                    <span class="sr-only">Istio 的数据平面 Envoy Proxy 配置详解 - 跳到主页</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">切换导航</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/">主页</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">博客</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">文档 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      
                        <li><a href="/awesome-servicemesh/">Service Mesh列表</a></li>
                      
                        <li><a href="/envoy/">Envoy官方文档中文版</a></li>
                      
                        <li><a href="https://preliminary.istio.io/zh/">Istio中文官网</a></li>
                      
                        <li><a href="/categories/practice/">实践汇总</a></li>
                      
                        <li><a href="/istio-handbook/">Istio Handbook</a></li>
                      
                        <li><a href="/getting-started-with-knative/">Knative入门</a></li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">社区 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      
                        <li><a href="/tags/meetup">Meetup</a></li>
                      
                        <li><a href="/authors/">作者投稿</a></li>
                      
                        <li><a href="/translators/">译者投稿</a></li>
                      
                        <li><a href="https://github.com/servicemesher/istio-knowledge-map">Istio知识图谱</a></li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">联系我们</a>
                    
                  </li>
                  
                  
                    <li>
                        <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
                        <span class="hidden-sm hidden-md hidden-lg">搜索</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
                    </a>
                    </li>
                  
                </ul>
            </div>
            

        </div>
    </div>
    

</div>




<div id="modalSearch" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">博客搜索</h4>
      </div>
      <div class="modal-body">
          
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="输入文章标题或摘要" name="search" autocomplete="off" autofocus="autofocus"/>
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>
<script src="/js/algoliasearch.min.js"></script>
<script src="/js/autocomplete.min.js"></script>

<script>
var client = algoliasearch("X4YB3WOBNV", "d2134c5a8d250e6d3246594240c45201");
var index = client.initIndex("servicemesher");

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            baseURL="http:\/\/www.servicemesher.com\/"
            baseURL=baseURL.substring(0,baseURL.length-1)
            return '<span>' + '<a href="' + baseURL + suggestion.url+ '">' +
                suggestion._highlightResult.title.value + '</a></span>'+
                '<span>'+suggestion._highlightResult.summary.value+'</span>';
        }
    }
});
</script>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
      </div>
    </div>
  </div>
</div>


        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Istio 的数据平面 Envoy Proxy 配置详解</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">
                        <div class="well">
                            <div class="author-category">
                            <i class="fa fa-calendar-o">
                            2019年1月7日
                            </i>
                            |
                            
                            作者 <a href="https://jimmysong.io">宋净超</a>
                            
                            
                            
                            |
                            5200字 | 阅读大约需要11分钟
                            </div>
                            
                            
                            <div class="author-category">
                            
                            <a href="https://jimmysong.io/posts/envoy-proxy-config-deep-dive/">查看原文</a>
                            |
                            
                            
                            归档于 <a href="/categories/envoy">envoy</a>
                            
                            |
                            
                            
                            
                            标签
                            
                            <a style="text-transform:capitalize" href="/tags/envoy/"><i>#envoy</i></a>
                            
                            <a style="text-transform:capitalize" href="/tags/xds/"><i>#xds</i></a>
                            
                            </div>
                            
                            
                        </div>
                        <div id="post-content">
                          

<p>Envoy 是 Istio Service Mesh 中默认的 Sidecar，Istio 在 Enovy 的基础上按照 Envoy 的 xDS 协议扩展了其控制平面，在讲到 Envoy xDS 协议之前还需要我们先熟悉下 Envoy 的基本术语。下面列举了 Envoy 里的基本术语及其数据结构解析，关于 Envoy 的详细介绍请参考 <a href="http://www.servicemesher.com/envoy/">Envoy 官方文档</a>，至于 Envoy 在 Service Mesh（不仅限于 Istio） 中是如何作为转发代理工作的请参考网易云刘超的这篇<a href="https://www.cnblogs.com/163yun/p/8962278.html">深入解读 Service Mesh 背后的技术细节 </a>以及<a href="https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/">理解 Istio Service Mesh 中 Envoy 代理 Sidecar 注入及流量劫持</a>，本文引用其中的一些观点，详细内容不再赘述。</p>

<p><img src="https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-proxy-config-deep-dive/006tNbRwly1fy9qkff5nij314k0ts43z.jpg" alt="Envoy proxy 架构图" /></p>

<h3 id="基本术语">基本术语</h3>

<p>下面是您应该了解的 Enovy 里的基本术语：</p>

<ul>
<li><strong>Downstream（下游）</strong>：下游主机连接到 Envoy，发送请求并接收响应，即发送请求的主机。</li>
<li><strong>Upstream（上游）</strong>：上游主机接收来自 Envoy 的连接和请求，并返回响应，即接受请求的主机。</li>
<li><strong>Listener（监听器）</strong>：监听器是命名网地址（例如，端口、unix domain socket 等)，下游客户端可以连接这些监听器。Envoy 暴露一个或者多个监听器给下游主机连接。</li>
<li><strong>Cluster（集群）</strong>：集群是指 Envoy 连接的一组逻辑相同的上游主机。Envoy 通过<a href="http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html#arch-overview-service-discovery">服务发现</a>来发现集群的成员。可以选择通过<a href="http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking">主动健康检查</a>来确定集群成员的健康状态。Envoy 通过<a href="http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing">负载均衡策略</a>决定将请求路由到集群的哪个成员。</li>
</ul>

<p>我将在本文的后半部分解释以上术语与 Kubernetes、Istio 中概念之间的联系。</p>

<h2 id="关于-xds-的版本">关于 xDS 的版本</h2>

<p>有一点需要大家注意，就是 Envoy 的 API 有 v1 和 v2 两个版本，从 Envoy 1.5.0 起 v2 API 就已经生产就绪了，为了能够让用户顺利的向 v2 版本的额 API 过度，Envoy 启动的时候设置了一个 <code>--v2-config-only</code> 的标志，Enovy 不同版本对 v1/v2 API 的支持详情请参考 <a href="https://groups.google.com/forum/#!topic/envoy-announce/Lb1QZcSclGQ">Envoy v1 配置废弃时间表</a>。</p>

<p>Envoy 的作者 Matt Klein 在 <a href="http://www.servicemesher.com/blog/the-universal-data-plane-api/">Service Mesh 中的通用数据平面 API 设计</a>这篇文章中说明了 Envoy API v1 的历史及其缺点，还有 v2 的引入。v2 API 是 v1 的演进，而不是革命，它是 v1 功能的超集。</p>

<p>在 Istio 1.0 及以上版本中使用的是 <strong>Envoy 1.8.0-dev</strong> 版本，其支持 v2 的 API，同时在 Envoy 作为 Sidecar proxy 启动的使用使用了例如下面的命令：</p>

<pre><code class="language-bash">$ /usr/local/bin/envoy -c /etc/istio/proxy/envoy-rev0.json --restart-epoch 0 --drain-time-s 45 --parent-shutdown-time-s 60 --service-cluster ratings --service-node sidecar~172.33.14.2~ratings-v1-8558d4458d-ld8x9.default~default.svc.cluster.local --max-obj-name-len 189 --allow-unknown-fields -l warn --v2-config-only
</code></pre>

<p>上面是都 Bookinfo 示例中的 rating pod 中的 sidecar 启动的分析，可以看到其中指定了 <code>--v2-config-only</code>，表明 Istio 1.0+ 只支持 xDS v2 的 API。</p>

<h2 id="istio-sidecar-proxy-配置">Istio sidecar proxy 配置</h2>

<p>假如您使用 <a href="https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster">kubernetes-vagrant-centos-cluster</a> 部署了 Kubernetes 集群并开启了 <a href="https://istio.io/zh">Istio Service Mesh</a>，再部署 <a href="https://istio.io/zh/docs/examples/bookinfo/">bookinfo 示例</a>，那么在 <code>default</code> 命名空间下有一个名字类似于 <code>ratings-v1-7c9949d479-dwkr4</code> 的 Pod，使用下面的命令查看该 Pod 的 Envoy sidecar 的全量配置：</p>

<pre><code class="language-bash">kubectl -n default exec ratings-v1-7c9949d479-dwkr4 -c istio-proxy curl http://localhost:15000/config_dump &gt; dump-rating.json
</code></pre>

<p>将 Envoy 的运行时配置 dump 出来之后你将看到一个长 6000 余行的配置文件。关于该配置文件的介绍请参考 <a href="http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html">Envoy v2 API 概览</a>。</p>

<p><img src="https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-proxy-config-deep-dive/006tNbRwly1fyb74brsd5j30xg0lojvt.jpg" alt="Envoy 配置" /></p>

<p>Istio 会在为 Service Mesh 中的每个 Pod 注入 Sidecar 的时候同时为 Envoy 注入 Bootstrap 配置，其余的配置是通过 Pilot 下发的，注意整个数据平面即 Service Mesh 中的 Envoy 的动态配置应该是相同的。您也可以使用上面的命令检查其他 sidecar 的 Envoy 配置是否跟最上面的那个相同。</p>

<p>使用下面的命令检查 Service Mesh 中的所有有 Sidecar 注入的 Pod 中的 proxy 配置是否同步。</p>

<pre><code class="language-bash">$ istioctl proxy-status
PROXY                                                 CDS        LDS        EDS               RDS          PILOT                            VERSION
details-v1-876bf485f-sx7df.default                    SYNCED     SYNCED     SYNCED (100%)     SYNCED       istio-pilot-5bf6d97f79-6lz4x     1.0.0
...
</code></pre>

<p><a href="https://istio.io/zh/docs/reference/commands/istioctl/">istioctl</a> 这个命令行工具就像 <a href="https://jimmysong.io/kubernetes-handbook/guide/kubectl-cheatsheet.html">kubectl</a> 一样有很多神器的魔法，通过它可以高效的管理 Istio 和 debug。</p>

<h2 id="envoy-proxy-配置解析">Envoy proxy 配置解析</h2>

<p>Istio envoy sidecar proxy 配置中包含以下四个部分。</p>

<ul>
<li><strong>bootstrap</strong>：Envoy proxy 启动时候加载的静态配置。</li>
<li><strong>listeners</strong>：监听器配置，使用 LDS 下发。</li>
<li><strong>clusters</strong>：集群配置，静态配置中包括 xds-grpc 和 zipkin 地址，动态配置使用  CDS 下发。</li>
<li><strong>routes</strong>：路由配置，静态配置中包括了本地监听的服务的集群信息，其中引用了 cluster，动态配置使用 RDS 下发。</li>
</ul>

<p>每个部分中都包含静态配置与动态配置，其中 bootstrap 配置又是在集群启动的时候通过 sidecar 启动参数注入的，配置文件在 <code>/etc/istio/proxy/envoy-rev0.json</code>。</p>

<p>Enovy 的配置 dump 出来后的结构如下图所示。</p>

<p><img src="https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2x2zk1hhj30ee0h9jtg.jpg" alt="Envoy 配置" /></p>

<p>由于 bootstrap 中的配置是来自 Envoy 启动时加载的静态文件，主要配置了节点信息、tracing、admin 和统计信息收集等信息，这不是本文的重点，大家可以自行研究。</p>

<p><img src="https://raw.githubusercontent.com/servicemesher/website/master/content/blog/envoy-proxy-config-deep-dive/006tNbRwly1fy2xid761zj30c70ai0tj.jpg" alt="bootstrap 配置" /></p>

<p>上图是 bootstrap 的配置信息。</p>

<p><a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> 是 Envoy 中配置的根本来源，<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-msg-config-bootstrap-v2-bootstrap">Bootstrap</a> 消息中有一个关键的概念，就是静态和动态资源的之间的区别。例如 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/lds.proto.html#envoy-api-msg-listener">Listener</a> 或 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto.html#envoy-api-msg-cluster">Cluster</a> 这些资源既可以从 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-static-resources">static_resources</a> 静态的获得也可以从 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/bootstrap/v2/bootstrap.proto.html#envoy-api-field-config-bootstrap-v2-bootstrap-dynamic-resources">dynamic_resources</a> 中配置的 <a href="http://www.servicemesher.com/envoy/configuration/listeners/lds.html#config-listeners-lds">LDS</a> 或 <a href="http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html#config-cluster-manager-cds">CDS</a> 之类的 xDS 服务获取。</p>

<h3 id="listener">Listener</h3>

<p>Listener 顾名思义，就是监听器，监听 IP 地址和端口，然后根据策略转发。</p>

<p><strong>Listener 的特点</strong></p>

<ul>
<li>每个 Envoy 进程中可以有多个 Listener，Envoy 与 Listener 之间是一对多的关系。</li>
<li>每个 Listener 中可以配置一条 filter 链表（filter_chains），Envoy 会根据 filter 顺序执行过滤。</li>
<li>Listener 可以监听下游的端口，也可以接收来自其他 listener 的数据，形成链式处理。</li>
<li>filter 是可扩展的。</li>
<li>可以静态配置，也可以使用 LDS 动态配置。</li>
<li>目前只能监听 TCP，UDP 还未支持。</li>
</ul>

<p><strong>Listener 的数据结构</strong></p>

<p>Listener 的数据结构如下，除了 <code>name</code>、<code>address</code> 和 <code>filter_chains</code> 为必须配置之外，其他都为可选的。</p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;...&quot;,
  &quot;address&quot;: &quot;{...}&quot;,
  &quot;filter_chains&quot;: [],
  &quot;use_original_dst&quot;: &quot;{...}&quot;,
  &quot;per_connection_buffer_limit_bytes&quot;: &quot;{...}&quot;,
  &quot;metadata&quot;: &quot;{...}&quot;,
  &quot;drain_type&quot;: &quot;...&quot;,
  &quot;listener_filters&quot;: [],
  &quot;transparent&quot;: &quot;{...}&quot;,
  &quot;freebind&quot;: &quot;{...}&quot;,
  &quot;socket_options&quot;: [],
  &quot;tcp_fast_open_queue_length&quot;: &quot;{...}&quot;,
  &quot;bugfix_reverse_write_filter_order&quot;: &quot;{...}&quot;
}
</code></pre>

<p>下面是关于上述数据结构中的常用配置解析。</p>

<ul>
<li><p><strong>name</strong>：该 listener 的 UUID，唯一限定名，默认60个字符，例如 <code>10.254.74.159_15011</code>，可以使用命令参数指定长度限制。</p></li>

<li><p><strong>address</strong>：监听的逻辑/物理地址和端口号，例如</p></li>
</ul>

<pre><code class="language-json">  &quot;address&quot;: {
         &quot;socket_address&quot;: {
          &quot;address&quot;: &quot;10.254.74.159&quot;,
          &quot;port_value&quot;: 15011
         }
  }
</code></pre>

<ul>
<li><p><strong>filter_chains</strong>：这是一个列表，Envoy 中内置了一些通用的 filter，每种 filter 都有特定的数据结构，Enovy 会根据该配置顺序执行 filter。Envoy 中内置的 filter 有：<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/client_ssl_auth_filter#config-network-filters-client-ssl-auth">envoy.client_ssl_auth</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/echo_filter#config-network-filters-echo">envoy.echo</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/http_conn_man/http_conn_man#config-http-conn-man">enovy.http_connection_manager</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/mongo_proxy_filter#config-network-filters-mongo-proxy">envoy.mongo_proxy</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/rate_limit_filter#config-network-filters-rate-limit">envoy.rate_limit</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/redis_proxy_filter#config-network-filters-redis-proxy">enovy.redis_proxy</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/network_filters/tcp_proxy_filter#config-network-filters-tcp-proxy">envoy.tcp_proxy</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/intro/arch_overview/http_filters">http_filters</a>、<a href="https://www.envoyproxy.io/docs/envoy/v1.8.0/configuration/thrift_filters/thrift_filters">thrift_filters</a>等。这些 filter 可以单独使用也可以组合使用，还可以自定义扩展，例如使用 Istio 中的 <a href="https://istio.io/zh/docs/reference/config/istio.networking.v1alpha3/#envoyfilter">EnvoyFilter 配置</a>。</p></li>

<li><p><strong>use_original_dst</strong>：这是一个布尔值，如果使用 iptables 重定向连接，则代理接收的端口可能与<a href="http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html">原始目的地址</a>的端口不一样。当此标志设置为 true 时，Listener 将重定向的连接切换到与原始目的地址关联的 Listener。如果没有与原始目的地址关联的 Listener，则连接由接收它的 Listener 处理。默认为 false。注意：该参数将被废弃，请使用<a href="http://www.servicemesher.com/envoy/configuration/listener_filters/original_dst_filter.html">原始目的地址</a>的 Listener filter 替代。该参数的主要用途是：Envoy 通过监听 15001 端口将应用的流量截取后再由其他 Listener 处理而不是直接转发出去，详情见 <a href="https://zhaohuabing.com/post/2018-09-25-istio-traffic-management-impl-intro/#virtual-listener">Virtual Listener</a>。</p></li>
</ul>

<p>关于 Listener 的详细介绍请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/lds.proto#envoy-api-msg-listener">Envoy v2 API reference - listener</a>。</p>

<h3 id="route">Route</h3>

<p>我们在这里所说的路由指的是 <a href="http://www.servicemesher.com/envoy/intro/arch_overview/http_routing.html">HTTP 路由</a>，这也使得 Envoy 可以用来处理网格边缘的流量。HTTP 路由转发是通过路由过滤器实现的。该过滤器的主要职能就是执行<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route_config#config-http-conn-man-route-table">路由表</a>中的指令。除了可以做重定向和转发，路由过滤器还需要处理重试、统计之类的任务。</p>

<p><strong>HTTP 路由的特点</strong></p>

<ul>
<li>前缀和精确路径匹配规则。</li>
<li>可跨越多个上游集群进行基于<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route#config-http-conn-man-route-table-route-weighted-clusters">权重/百分比的路由</a>。</li>
<li>基于<a href="http://www.servicemesher.com/envoy/intro/arch_overview/http_routing.html#arch-overview-http-routing-priority">优先级</a>的路由。</li>
<li>基于<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v1/route_config/route#config-http-conn-man-route-table-hash-policy">哈希</a>策略的路由。</li>
</ul>

<p><strong>Route 的数据结构</strong></p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;...&quot;,
  &quot;virtual_hosts&quot;: [],
  &quot;internal_only_headers&quot;: [],
  &quot;response_headers_to_add&quot;: [],
  &quot;response_headers_to_remove&quot;: [],
  &quot;request_headers_to_add&quot;: [],
  &quot;request_headers_to_remove&quot;: [],
  &quot;validate_clusters&quot;: &quot;{...}&quot;
}
</code></pre>

<p>下面是关于上述数据结构中的常用配置解析。</p>

<ul>
<li><strong>name</strong>：该名字跟 <code>envoy.http_connection_manager</code> filter 中的 <code>http_filters.rds.route_config_name</code> 一致，在 Istio Service Mesh 中为 Envoy 下发的配置中的 Route 是以监听的端口号作为名字，而同一个名字下面的 <code>virtual_hosts</code> 可以有多个值（数组形式）。</li>
<li><strong>virtual_hosts</strong>：因为 <strong>VirtualHosts</strong> 是 Envoy 中引入的一个重要概念，我们在下文将详细说明 <code>virtual_hosts</code> 的数据结构。</li>
<li><strong>validate_clusters</strong>：这是一个布尔值，用来设置开启使用 cluster manager 来检测路由表引用的 cluster 是否有效。如果是路由表是通过 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-route-config">route_config</a> 静态配置的则该值默认设置为 true，如果是使用 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-field-config-filter-network-http-connection-manager-v2-httpconnectionmanager-rds">rds</a> 动态配置的话，则该值默认设置为 false。</li>
</ul>

<p>关于 Route 的详细介绍请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/rds.proto">Envoy v2 API reference - HTTP route configuration</a>。</p>

<h4 id="route-virtualhost">route.VirtualHost</h4>

<p>VirtualHost 即上文中 Route 配置中的 <code>virtual_hosts</code>，VirtualHost 是路由配置中的顶级元素。每个虚拟主机都有一个逻辑名称以及一组根据传入请求的 host header 路由到它的域。这允许单个 Listener 为多个顶级域路径树提供服务。基于域选择了虚拟主机后 Envoy  就会处理路由以查看要路由到哪个上游集群或是否执行重定向。</p>

<p><strong>VirtualHost 的数据结构</strong></p>

<p>下面是 VirtualHost 的数据结构，除了 <code>name</code> 和 <code>domains</code> 是必须配置项外，其他皆为可选项。</p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;...&quot;,
  &quot;domains&quot;: [],
  &quot;routes&quot;: [],
  &quot;require_tls&quot;: &quot;...&quot;,
  &quot;virtual_clusters&quot;: [],
  &quot;rate_limits&quot;: [],
  &quot;request_headers_to_add&quot;: [],
  &quot;request_headers_to_remove&quot;: [],
  &quot;response_headers_to_add&quot;: [],
  &quot;response_headers_to_remove&quot;: [],
  &quot;cors&quot;: &quot;{...}&quot;,
  &quot;per_filter_config&quot;: &quot;{...}&quot;,
  &quot;include_request_attempt_count&quot;: &quot;...&quot;
}
</code></pre>

<p>下面是关于上述数据结构中的常用配置解析。</p>

<ul>
<li><strong>name</strong>：该 VirtualHost 的名字，一般是 FQDN 加端口，如 <code>details.default.svc.cluster.local:9080</code>。</li>
<li><strong>domains</strong>：这是个用来匹配 VirtualHost 的域名（host/authority header）列表，也可以使用通配符，但是通配符不能匹配空字符，除了仅使用 <code>*</code> 作为 domains，注意列表中的值不能重复和存在交集，只要有一条 domain 被匹配上了，就会执行路由。Istio 会为该值配置所有地址解析形式，包括 IP 地址、FQDN 和短域名等。</li>
<li><strong>routes</strong>：针对入口流量的有序路由列表，第一个匹配上的路由将被执行。我们在下文将详细说明 route 的数据结构。</li>
</ul>

<p>下面是一个实际的 VirtualHost 的例子，该配置来自 <a href="https://istio.io/zh/docs/examples/bookinfo/">Bookinfo 应用</a>的 details 应用的 Sidecar 服务。</p>

<pre><code class="language-json">{
            &quot;name&quot;: &quot;details.default.svc.cluster.local:9080&quot;,
            &quot;domains&quot;: [
                &quot;details.default.svc.cluster.local&quot;,
                &quot;details.default.svc.cluster.local:9080&quot;,
                &quot;details&quot;,
                &quot;details:9080&quot;,
                &quot;details.default.svc.cluster&quot;,
                &quot;details.default.svc.cluster:9080&quot;,
                &quot;details.default.svc&quot;,
                &quot;details.default.svc:9080&quot;,
                &quot;details.default&quot;,
                &quot;details.default:9080&quot;,
                &quot;10.254.4.113&quot;,
                &quot;10.254.4.113:9080&quot;
            ],
            &quot;routes&quot;: [
                {
                    &quot;match&quot;: {
                        &quot;prefix&quot;: &quot;/&quot;
                    },
                    &quot;route&quot;: {
                        &quot;cluster&quot;: &quot;outbound|9080||details.default.svc.cluster.local&quot;,
                        &quot;timeout&quot;: &quot;0s&quot;,
                        &quot;max_grpc_timeout&quot;: &quot;0s&quot;
                    },
                    &quot;decorator&quot;: {
                        &quot;operation&quot;: &quot;details.default.svc.cluster.local:9080/*&quot;
                    },
                    &quot;per_filter_config&quot;: {
                        &quot;mixer&quot;: {
                            &quot;forward_attributes&quot;: {
                                &quot;attributes&quot;: {
                                    &quot;destination.service.uid&quot;: {
                                        &quot;string_value&quot;: &quot;istio://default/services/details&quot;
                                    },
                                    &quot;destination.service.host&quot;: {
                                        &quot;string_value&quot;: &quot;details.default.svc.cluster.local&quot;
                                    },
                                    &quot;destination.service.namespace&quot;: {
                                        &quot;string_value&quot;: &quot;default&quot;
                                    },
                                    &quot;destination.service.name&quot;: {
                                        &quot;string_value&quot;: &quot;details&quot;
                                    },
                                    &quot;destination.service&quot;: {
                                        &quot;string_value&quot;: &quot;details.default.svc.cluster.local&quot;
                                    }
                                }
                            },
                            &quot;mixer_attributes&quot;: {
                                &quot;attributes&quot;: {
                                    &quot;destination.service.host&quot;: {
                                        &quot;string_value&quot;: &quot;details.default.svc.cluster.local&quot;
                                    },
                                    &quot;destination.service.uid&quot;: {
                                        &quot;string_value&quot;: &quot;istio://default/services/details&quot;
                                    },
                                    &quot;destination.service.name&quot;: {
                                        &quot;string_value&quot;: &quot;details&quot;
                                    },
                                    &quot;destination.service.namespace&quot;: {
                                        &quot;string_value&quot;: &quot;default&quot;
                                    },
                                    &quot;destination.service&quot;: {
                                        &quot;string_value&quot;: &quot;details.default.svc.cluster.local&quot;
                                    }
                                }
                            },
                            &quot;disable_check_calls&quot;: true
                        }
                    }
                }
            ]
        }
</code></pre>

<p>关于 route.VirtualHost 的详细介绍请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-msg-route-virtualhost">Envoy v2 API reference - route.VirtualHost</a>。</p>

<h4 id="route-route">route.Route</h4>

<p>路由既是如何匹配请求的规范，也是对下一步做什么的指示（例如，redirect、forward、rewrite等）。</p>

<p><strong>route.Route 的数据结构</strong></p>

<p>下面是是 route.Route 的数据结构，除了 <code>match</code> 之外其余都是可选的。</p>

<pre><code class="language-json">{
  &quot;match&quot;: &quot;{...}&quot;,
  &quot;route&quot;: &quot;{...}&quot;,
  &quot;redirect&quot;: &quot;{...}&quot;,
  &quot;direct_response&quot;: &quot;{...}&quot;,
  &quot;metadata&quot;: &quot;{...}&quot;,
  &quot;decorator&quot;: &quot;{...}&quot;,
  &quot;per_filter_config&quot;: &quot;{...}&quot;,
  &quot;request_headers_to_add&quot;: [],
  &quot;request_headers_to_remove&quot;: [],
  &quot;response_headers_to_add&quot;: [],
  &quot;response_headers_to_remove&quot;: []
}
</code></pre>

<p>下面是关于上述数据结构中的常用配置解析。</p>

<ul>
<li><strong>match</strong>：路由匹配参数。例如 URL prefix（前缀）、path（URL 的完整路径）、regex（规则表达式）等。</li>
<li><strong>route</strong>：这里面配置路由的行为，可以是 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-route">route</a>、<a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-redirect">redirect</a> 和 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-field-route-route-direct-response">direct_response</a>，不过这里面没有专门的一个配置项用来配置以上三种行为，而是根据实际填充的配置项来确定的。例如在此处添加 <code>cluster</code> 配置则暗示路由动作为”route“，表示将流量路由到该 cluster。详情请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#route-routeaction">route.RouteAction</a>。</li>
<li><strong>decorator</strong>：被匹配的路由的修饰符，表示被匹配的虚拟主机和 URL。该配置里有且只有一个必须配置的项 <code>operation</code>，例如 <code>details.default.svc.cluster.local:9080/*</code>。</li>
<li><strong>per_filter_config</strong>：这是一个 map 类型，<code>per_filter_config</code> 字段可用于为 filter 提供特定路由的配置。Map 的 key 应与 filleter 名称匹配，例如用于 HTTP buffer filter 的 <code>envoy.buffer</code>。该字段是特定于 filter 的，详情请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/http_filters#config-http-filters">HTTP filter</a>。</li>
</ul>

<p>关于 route.Route 的详细介绍请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route.proto#envoy-api-msg-route-route">Envoy v2 API reference - route.Route</a>。</p>

<h3 id="cluster">Cluster</h3>

<p>Cluster 是指 Envoy 连接的一组逻辑相同的上游主机。Envoy 通过<a href="http://www.servicemesher.com/envoy/intro/arch_overview/service_discovery.html">服务发现</a>来发现 cluster 的成员。可以选择通过<a href="http://www.servicemesher.com/envoy/intro/arch_overview/health_checking.html#arch-overview-health-checking">主动健康检查</a>来确定集群成员的健康状态。Envoy 通过<a href="http://www.servicemesher.com/envoy/intro/arch_overview/load_balancing.html#arch-overview-load-balancing">负载均衡策略</a>决定将请求路由到 cluster 的哪个成员。</p>

<p><strong>Cluster 的特点</strong></p>

<ul>
<li>一组逻辑上相同的主机构成一个 cluster。</li>
<li>可以在 cluster 中定义各种负载均衡策略。</li>
<li>新加入的 cluster 需要一个热身的过程才可以给路由引用，该过程是原子的，即在 cluster 热身之前对于 Envoy 及 Service Mesh 的其余部分来说是不可见的。</li>
<li>可以通过多种方式来配置 cluster，例如静态类型、严格限定 DNS、逻辑 DNS、EDS 等。</li>
</ul>

<p><strong>Cluster 的数据结构</strong></p>

<p>Cluster 的数据结构如下，除了 <code>name</code> 字段，其他都是可选的。</p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;...&quot;,
  &quot;alt_stat_name&quot;: &quot;...&quot;,
  &quot;type&quot;: &quot;...&quot;,
  &quot;eds_cluster_config&quot;: &quot;{...}&quot;,
  &quot;connect_timeout&quot;: &quot;{...}&quot;,
  &quot;per_connection_buffer_limit_bytes&quot;: &quot;{...}&quot;,
  &quot;lb_policy&quot;: &quot;...&quot;,
  &quot;hosts&quot;: [],
  &quot;load_assignment&quot;: &quot;{...}&quot;,
  &quot;health_checks&quot;: [],
  &quot;max_requests_per_connection&quot;: &quot;{...}&quot;,
  &quot;circuit_breakers&quot;: &quot;{...}&quot;,
  &quot;tls_context&quot;: &quot;{...}&quot;,
  &quot;common_http_protocol_options&quot;: &quot;{...}&quot;,
  &quot;http_protocol_options&quot;: &quot;{...}&quot;,
  &quot;http2_protocol_options&quot;: &quot;{...}&quot;,
  &quot;extension_protocol_options&quot;: &quot;{...}&quot;,
  &quot;dns_refresh_rate&quot;: &quot;{...}&quot;,
  &quot;dns_lookup_family&quot;: &quot;...&quot;,
  &quot;dns_resolvers&quot;: [],
  &quot;outlier_detection&quot;: &quot;{...}&quot;,
  &quot;cleanup_interval&quot;: &quot;{...}&quot;,
  &quot;upstream_bind_config&quot;: &quot;{...}&quot;,
  &quot;lb_subset_config&quot;: &quot;{...}&quot;,
  &quot;ring_hash_lb_config&quot;: &quot;{...}&quot;,
  &quot;original_dst_lb_config&quot;: &quot;{...}&quot;,
  &quot;least_request_lb_config&quot;: &quot;{...}&quot;,
  &quot;common_lb_config&quot;: &quot;{...}&quot;,
  &quot;transport_socket&quot;: &quot;{...}&quot;,
  &quot;metadata&quot;: &quot;{...}&quot;,
  &quot;protocol_selection&quot;: &quot;...&quot;,
  &quot;upstream_connection_options&quot;: &quot;{...}&quot;,
  &quot;close_connections_on_host_health_failure&quot;: &quot;...&quot;,
  &quot;drain_connections_on_host_removal&quot;: &quot;...&quot;
}
</code></pre>

<p>下面是关于上述数据结构中的常用配置解析。</p>

<ul>
<li><strong>name</strong>：如果你留意到作为 Sidecar 启动的 Envoy 的参数的会注意到 <code>--max-obj-name-len 189</code>，该选项用来用来指定 cluster 的名字，例如 <code>inbound|9080||ratings.default.svc.cluster.local</code>。该名字字符串由 <code>|</code> 分隔成四个部分，分别是 <code>inbound</code> 或 <code>outbound</code> 代表入向流量或出向流量、端口号、subcluster 名称、FQDN，其中 subcluster 名称将对应于 Istio <code>DestinationRule</code> 中配置的 <code>subnet</code>，如果是按照多版本按比例路由的话，该值可以是版本号。</li>
<li><strong>type</strong>：即<a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/service_discovery#arch-overview-service-discovery-types">服务发现类型</a>，支持的参数有 <code>STATIC</code>（缺省值）、<code>STRICT_DNS</code>、<code>LOGICAL_DNS</code>、<code>EDS</code>、<code>ORIGINAL_DST</code>。</li>
<li><strong>hosts</strong>：这是个列表，配置负载均衡的 IP 地址和端口，只有使用了  <code>STATIC</code>、<code>STRICT_DNS</code>、<code>LOGICAL_DNS</code> 服务发现类型时才需要配置。</li>
<li><strong>eds_cluster_config</strong>：如果使用 <code>EDS</code> 做服务发现，则需要配置该项目，其中包括的配置有 <code>service_name</code> 和 <code>ads</code>。</li>
</ul>

<p>关于 Cluster 的详细介绍请参考 <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto#cluster">Envoy v2 API reference - cluster</a>。</p>

<h2 id="参考">参考</h2>

<ul>
<li><a href="http://www.servicemesher.com/envoy/configuration/overview/v2_overview.html">Envoy v2 API 概览 - servicemesher.com</a></li>
<li><a href="http://www.servicemesher.com/envoy/configuration/listeners/lds.html">监听器发现服务（LDS）- servicemesher.com</a></li>
<li><a href="http://www.servicemesher.com/envoy/configuration/http_conn_man/rds.html">路由发现服务（RDS）- servicemesher.com</a></li>
<li><a href="http://www.servicemesher.com/envoy/configuration/cluster_manager/cds.html">集群发现服务（CDS）- servicemesher.com</a></li>
<li><a href="https://jimmysong.io/istio-handbook/concepts/envoy-xds-protocol.html">xDS 协议解析 - jimmysong.io</a></li>
<li><a href="https://www.cnblogs.com/163yun/p/8962278.html">深入解读 Service Mesh 背后的技术细节 - cnblogs.com</a><a href="https://jimmysong.io/posts/envoy-sidecar-injection-in-istio-service-mesh-deep-dive/">理解 Istio Service Mesh 中 Envoy 代理 Sidecar 注入及流量劫持 - jimmysong.io</a></li>
</ul>

                        </div>
                        
                        
                        
                        
                        <ul class="pager blog-pager">
                        
                        <li class="previous">
                        <a href="http://www.servicemesher.com/blog/supergloo-a-service-mesh-orchestrator/" data-toggle="tooltip" data-placement="top" title="SuperGloo—服务网格编排平台">&larr; 更旧</a>
                        </li>
                         
                        <li class="next">
                        <a href="http://www.servicemesher.com/blog/service-mesh-meetup-guangzhou-20190106/" data-toggle="tooltip" data-placement="top" title="第五届Service Mesh Meetup广州站回顾">更新 &rarr;</a>
                        </li>
                        
                        </ul>

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        <div class="panel panel-default sidebar-menu">
     
    <div class="panel-heading">
     <h3 class="panel-title">相关文章</h3>
    </div>
    <div class="panel-body">
     <ul class="nav nav-pills nav-stacked">
        
        <li><a href="/blog/envoy-xds-protocol/"><i class="fa fa-link"></i>Envoy 中的 xDS REST 和 gRPC 协议详解</a></li>
         
        <li><a href="/blog/istio-service-and-traffic-model/"><i class="fa fa-link"></i>Istio中的服务和流量的抽象模型</a></li>
         
        <li><a href="/blog/distributed-tracing-with-envoy-service-mesh-jaeger/"><i class="fa fa-link"></i>使用Envoy和Jaeger实现分布式追踪</a></li>
         
        <li><a href="/blog/envoy-stats/"><i class="fa fa-link"></i>Envoy中的数据统计</a></li>
         
        <li><a href="/blog/istio-envoy-grpc-metrics-winning-with-service-mesh-in-practice/"><i class="fa fa-link"></i>使用Istio和Envoy实践服务网格gRPC度量</a></li>
         
     </ul>
    </div>
     
</div>





<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">分类</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="/categories/cloud-native-weekly"><i class="fa fa-navicon"></i>cloud-native-weekly (3)</a>
            </li>
            
            <li><a href="/categories/culture"><i class="fa fa-navicon"></i>culture (5)</a>
            </li>
            
            <li><a href="/categories/envoy"><i class="fa fa-navicon"></i>envoy (2)</a>
            </li>
            
            <li><a href="/categories/gitops"><i class="fa fa-navicon"></i>gitops (1)</a>
            </li>
            
            <li><a href="/categories/istio"><i class="fa fa-navicon"></i>istio (31)</a>
            </li>
            
            <li><a href="/categories/istio-mixer-cache"><i class="fa fa-navicon"></i>istio-mixer-cache (4)</a>
            </li>
            
            <li><a href="/categories/istio-source-deepin"><i class="fa fa-navicon"></i>istio-source-deepin (6)</a>
            </li>
            
            <li><a href="/categories/knative"><i class="fa fa-navicon"></i>knative (1)</a>
            </li>
            
            <li><a href="/categories/kubernetes"><i class="fa fa-navicon"></i>kubernetes (5)</a>
            </li>
            
            <li><a href="/categories/meetup"><i class="fa fa-navicon"></i>meetup (5)</a>
            </li>
            
            <li><a href="/categories/monitoring"><i class="fa fa-navicon"></i>monitoring (3)</a>
            </li>
            
            <li><a href="/categories/practice"><i class="fa fa-navicon"></i>practice (16)</a>
            </li>
            
            <li><a href="/categories/rate-limiting"><i class="fa fa-navicon"></i>rate-limiting (4)</a>
            </li>
            
            <li><a href="/categories/serverless"><i class="fa fa-navicon"></i>serverless (3)</a>
            </li>
            
            <li><a href="/categories/service-mesh"><i class="fa fa-navicon"></i>service-mesh (25)</a>
            </li>
            
            <li><a href="/categories/sofamesh"><i class="fa fa-navicon"></i>sofamesh (9)</a>
            </li>
            
            <li><a href="/categories/sofamosn"><i class="fa fa-navicon"></i>sofamosn (2)</a>
            </li>
            
            <li><a href="/categories/translation"><i class="fa fa-navicon"></i>translation (123)</a>
            </li>
            
            <li><a href="/categories/tutorial"><i class="fa fa-navicon"></i>tutorial (4)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">标签</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="/tags/ab-test"><i class="fa fa-tags"></i> ab-test</a>
            </li>
            
            <li><a href="/tags/ambassador"><i class="fa fa-tags"></i> ambassador</a>
            </li>
            
            <li><a href="/tags/ant-financial"><i class="fa fa-tags"></i> ant-financial</a>
            </li>
            
            <li><a href="/tags/anthos"><i class="fa fa-tags"></i> anthos</a>
            </li>
            
            <li><a href="/tags/api-gateway"><i class="fa fa-tags"></i> api-gateway</a>
            </li>
            
            <li><a href="/tags/api-management"><i class="fa fa-tags"></i> api-management</a>
            </li>
            
            <li><a href="/tags/app-mesh"><i class="fa fa-tags"></i> app-mesh</a>
            </li>
            
            <li><a href="/tags/aspen-mesh"><i class="fa fa-tags"></i> aspen-mesh</a>
            </li>
            
            <li><a href="/tags/aws"><i class="fa fa-tags"></i> aws</a>
            </li>
            
            <li><a href="/tags/baggage"><i class="fa fa-tags"></i> baggage</a>
            </li>
            
            <li><a href="/tags/chart"><i class="fa fa-tags"></i> chart</a>
            </li>
            
            <li><a href="/tags/ci-cd"><i class="fa fa-tags"></i> ci-cd</a>
            </li>
            
            <li><a href="/tags/cilium"><i class="fa fa-tags"></i> cilium</a>
            </li>
            
            <li><a href="/tags/circonus"><i class="fa fa-tags"></i> circonus</a>
            </li>
            
            <li><a href="/tags/circuit-breaking"><i class="fa fa-tags"></i> circuit-breaking</a>
            </li>
            
            <li><a href="/tags/cloud-native"><i class="fa fa-tags"></i> cloud-native</a>
            </li>
            
            <li><a href="/tags/cloud-run"><i class="fa fa-tags"></i> cloud-run</a>
            </li>
            
            <li><a href="/tags/cncf"><i class="fa fa-tags"></i> cncf</a>
            </li>
            
            <li><a href="/tags/conduit"><i class="fa fa-tags"></i> conduit</a>
            </li>
            
            <li><a href="/tags/consul"><i class="fa fa-tags"></i> consul</a>
            </li>
            
            <li><a href="/tags/container"><i class="fa fa-tags"></i> container</a>
            </li>
            
            <li><a href="/tags/coohom"><i class="fa fa-tags"></i> coohom</a>
            </li>
            
            <li><a href="/tags/coredns"><i class="fa fa-tags"></i> coredns</a>
            </li>
            
            <li><a href="/tags/crd"><i class="fa fa-tags"></i> crd</a>
            </li>
            
            <li><a href="/tags/dashboard"><i class="fa fa-tags"></i> dashboard</a>
            </li>
            
            <li><a href="/tags/distributing-system"><i class="fa fa-tags"></i> distributing-system</a>
            </li>
            
            <li><a href="/tags/docker"><i class="fa fa-tags"></i> docker</a>
            </li>
            
            <li><a href="/tags/dubbo"><i class="fa fa-tags"></i> dubbo</a>
            </li>
            
            <li><a href="/tags/envoy"><i class="fa fa-tags"></i> envoy</a>
            </li>
            
            <li><a href="/tags/event-driven"><i class="fa fa-tags"></i> event-driven</a>
            </li>
            
            <li><a href="/tags/evnet-mesh"><i class="fa fa-tags"></i> evnet-mesh</a>
            </li>
            
            <li><a href="/tags/f5"><i class="fa fa-tags"></i> f5</a>
            </li>
            
            <li><a href="/tags/faas"><i class="fa fa-tags"></i> faas</a>
            </li>
            
            <li><a href="/tags/fintech"><i class="fa fa-tags"></i> fintech</a>
            </li>
            
            <li><a href="/tags/fission"><i class="fa fa-tags"></i> fission</a>
            </li>
            
            <li><a href="/tags/flagger"><i class="fa fa-tags"></i> flagger</a>
            </li>
            
            <li><a href="/tags/fn"><i class="fa fa-tags"></i> fn</a>
            </li>
            
            <li><a href="/tags/function"><i class="fa fa-tags"></i> function</a>
            </li>
            
            <li><a href="/tags/gateway"><i class="fa fa-tags"></i> gateway</a>
            </li>
            
            <li><a href="/tags/gitops"><i class="fa fa-tags"></i> gitops</a>
            </li>
            
            <li><a href="/tags/glasnostic"><i class="fa fa-tags"></i> glasnostic</a>
            </li>
            
            <li><a href="/tags/gloo"><i class="fa fa-tags"></i> gloo</a>
            </li>
            
            <li><a href="/tags/golang"><i class="fa fa-tags"></i> golang</a>
            </li>
            
            <li><a href="/tags/google"><i class="fa fa-tags"></i> google</a>
            </li>
            
            <li><a href="/tags/grafana"><i class="fa fa-tags"></i> grafana</a>
            </li>
            
            <li><a href="/tags/grpc"><i class="fa fa-tags"></i> grpc</a>
            </li>
            
            <li><a href="/tags/grpc-web"><i class="fa fa-tags"></i> grpc-web</a>
            </li>
            
            <li><a href="/tags/harshicorp"><i class="fa fa-tags"></i> harshicorp</a>
            </li>
            
            <li><a href="/tags/helm"><i class="fa fa-tags"></i> helm</a>
            </li>
            
            <li><a href="/tags/huawei"><i class="fa fa-tags"></i> huawei</a>
            </li>
            
            <li><a href="/tags/hystrix"><i class="fa fa-tags"></i> hystrix</a>
            </li>
            
            <li><a href="/tags/ibm"><i class="fa fa-tags"></i> ibm</a>
            </li>
            
            <li><a href="/tags/infoq"><i class="fa fa-tags"></i> infoq</a>
            </li>
            
            <li><a href="/tags/ingress"><i class="fa fa-tags"></i> ingress</a>
            </li>
            
            <li><a href="/tags/ingress-gateway"><i class="fa fa-tags"></i> ingress-gateway</a>
            </li>
            
            <li><a href="/tags/ingresss"><i class="fa fa-tags"></i> ingresss</a>
            </li>
            
            <li><a href="/tags/iptables"><i class="fa fa-tags"></i> iptables</a>
            </li>
            
            <li><a href="/tags/istio"><i class="fa fa-tags"></i> istio</a>
            </li>
            
            <li><a href="/tags/jaeger"><i class="fa fa-tags"></i> jaeger</a>
            </li>
            
            <li><a href="/tags/jenkins"><i class="fa fa-tags"></i> jenkins</a>
            </li>
            
            <li><a href="/tags/jenkins-x"><i class="fa fa-tags"></i> jenkins-x</a>
            </li>
            
            <li><a href="/tags/kiali"><i class="fa fa-tags"></i> kiali</a>
            </li>
            
            <li><a href="/tags/knative"><i class="fa fa-tags"></i> knative</a>
            </li>
            
            <li><a href="/tags/kong"><i class="fa fa-tags"></i> kong</a>
            </li>
            
            <li><a href="/tags/kube-router"><i class="fa fa-tags"></i> kube-router</a>
            </li>
            
            <li><a href="/tags/kubeless"><i class="fa fa-tags"></i> kubeless</a>
            </li>
            
            <li><a href="/tags/kubernetes"><i class="fa fa-tags"></i> kubernetes</a>
            </li>
            
            <li><a href="/tags/kublr"><i class="fa fa-tags"></i> kublr</a>
            </li>
            
            <li><a href="/tags/lets-encrypt"><i class="fa fa-tags"></i> lets-encrypt</a>
            </li>
            
            <li><a href="/tags/linkerd"><i class="fa fa-tags"></i> linkerd</a>
            </li>
            
            <li><a href="/tags/lyft"><i class="fa fa-tags"></i> lyft</a>
            </li>
            
            <li><a href="/tags/matt-klein"><i class="fa fa-tags"></i> matt-klein</a>
            </li>
            
            <li><a href="/tags/meetup"><i class="fa fa-tags"></i> meetup</a>
            </li>
            
            <li><a href="/tags/microgateway"><i class="fa fa-tags"></i> microgateway</a>
            </li>
            
            <li><a href="/tags/microprofile"><i class="fa fa-tags"></i> microprofile</a>
            </li>
            
            <li><a href="/tags/microservice"><i class="fa fa-tags"></i> microservice</a>
            </li>
            
            <li><a href="/tags/microservices"><i class="fa fa-tags"></i> microservices</a>
            </li>
            
            <li><a href="/tags/middleware"><i class="fa fa-tags"></i> middleware</a>
            </li>
            
            <li><a href="/tags/monitor"><i class="fa fa-tags"></i> monitor</a>
            </li>
            
            <li><a href="/tags/monitoring"><i class="fa fa-tags"></i> monitoring</a>
            </li>
            
            <li><a href="/tags/mosn"><i class="fa fa-tags"></i> mosn</a>
            </li>
            
            <li><a href="/tags/naftis"><i class="fa fa-tags"></i> naftis</a>
            </li>
            
            <li><a href="/tags/nfv"><i class="fa fa-tags"></i> nfv</a>
            </li>
            
            <li><a href="/tags/open-shift"><i class="fa fa-tags"></i> open-shift</a>
            </li>
            
            <li><a href="/tags/open-source"><i class="fa fa-tags"></i> open-source</a>
            </li>
            
            <li><a href="/tags/openfaas"><i class="fa fa-tags"></i> openfaas</a>
            </li>
            
            <li><a href="/tags/openshift"><i class="fa fa-tags"></i> openshift</a>
            </li>
            
            <li><a href="/tags/opentracing"><i class="fa fa-tags"></i> opentracing</a>
            </li>
            
            <li><a href="/tags/operator"><i class="fa fa-tags"></i> operator</a>
            </li>
            
            <li><a href="/tags/paas"><i class="fa fa-tags"></i> paas</a>
            </li>
            
            <li><a href="/tags/pilot"><i class="fa fa-tags"></i> pilot</a>
            </li>
            
            <li><a href="/tags/prometheus"><i class="fa fa-tags"></i> prometheus</a>
            </li>
            
            <li><a href="/tags/prow"><i class="fa fa-tags"></i> prow</a>
            </li>
            
            <li><a href="/tags/proxy"><i class="fa fa-tags"></i> proxy</a>
            </li>
            
            <li><a href="/tags/rate-limiting"><i class="fa fa-tags"></i> rate-limiting</a>
            </li>
            
            <li><a href="/tags/red-hat"><i class="fa fa-tags"></i> red-hat</a>
            </li>
            
            <li><a href="/tags/security"><i class="fa fa-tags"></i> security</a>
            </li>
            
            <li><a href="/tags/servcie-mesh"><i class="fa fa-tags"></i> servcie-mesh</a>
            </li>
            
            <li><a href="/tags/serverless"><i class="fa fa-tags"></i> serverless</a>
            </li>
            
            <li><a href="/tags/service-mesh"><i class="fa fa-tags"></i> service-mesh</a>
            </li>
            
            <li><a href="/tags/servicemesh"><i class="fa fa-tags"></i> servicemesh</a>
            </li>
            
            <li><a href="/tags/sidecar"><i class="fa fa-tags"></i> sidecar</a>
            </li>
            
            <li><a href="/tags/smi"><i class="fa fa-tags"></i> smi</a>
            </li>
            
            <li><a href="/tags/sofa"><i class="fa fa-tags"></i> sofa</a>
            </li>
            
            <li><a href="/tags/sofamesh"><i class="fa fa-tags"></i> sofamesh</a>
            </li>
            
            <li><a href="/tags/sofamosn"><i class="fa fa-tags"></i> sofamosn</a>
            </li>
            
            <li><a href="/tags/sofastack"><i class="fa fa-tags"></i> sofastack</a>
            </li>
            
            <li><a href="/tags/source-code"><i class="fa fa-tags"></i> source-code</a>
            </li>
            
            <li><a href="/tags/sre"><i class="fa fa-tags"></i> sre</a>
            </li>
            
            <li><a href="/tags/supergloo"><i class="fa fa-tags"></i> supergloo</a>
            </li>
            
            <li><a href="/tags/tls"><i class="fa fa-tags"></i> tls</a>
            </li>
            
            <li><a href="/tags/tracing"><i class="fa fa-tags"></i> tracing</a>
            </li>
            
            <li><a href="/tags/trulia"><i class="fa fa-tags"></i> trulia</a>
            </li>
            
            <li><a href="/tags/tutorial"><i class="fa fa-tags"></i> tutorial</a>
            </li>
            
            <li><a href="/tags/ucloud"><i class="fa fa-tags"></i> ucloud</a>
            </li>
            
            <li><a href="/tags/ui"><i class="fa fa-tags"></i> ui</a>
            </li>
            
            <li><a href="/tags/vamp"><i class="fa fa-tags"></i> vamp</a>
            </li>
            
            <li><a href="/tags/vistio"><i class="fa fa-tags"></i> vistio</a>
            </li>
            
            <li><a href="/tags/vizceral"><i class="fa fa-tags"></i> vizceral</a>
            </li>
            
            <li><a href="/tags/x-protocol"><i class="fa fa-tags"></i> x-protocol</a>
            </li>
            
            <li><a href="/tags/xds"><i class="fa fa-tags"></i> xds</a>
            </li>
            
            <li><a href="/tags/xiaomi"><i class="fa fa-tags"></i> xiaomi</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>关于我们</h4>

            <p><p>传播Service Mesh技术、构建开源文化、推动Service Mesh在企业中落地</p><img src=/img/servicemesher-wechat-tiny.jpg></p>


            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/implementing-chatops-with-jenkins-x/">
                          
                          <img src="https://gw.alipayobjects.com/mdn/rms_91f3e6/afts/img/A*UNy3SKvtH3QAAAAAAAAAAABkARQnAQ" class="img-responsive" alt="使用Jenkins X实现ChatOps">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/implementing-chatops-with-jenkins-x/">使用Jenkins X实现ChatOps</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/service-mesh-interface-detail/">
                          
                          <img src="https://gw.alipayobjects.com/mdn/rms_91f3e6/afts/img/A*wk5LToh54pQAAAAAAAAAAABkARQnAQ" class="img-responsive" alt="Service Mesh Interface详细介绍">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/service-mesh-interface-detail/">Service Mesh Interface详细介绍</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/containers-microservices-service-meshes/">
                          
                          <img src="https://gw.alipayobjects.com/mdn/rms_91f3e6/afts/img/A*ynV-TqegwKAAAAAAAAAAAABkARQnAQ" class="img-responsive" alt="容器、微服务和服务网格简史">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/containers-microservices-service-meshes/">容器、微服务和服务网格简史</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>联系</h4>

            <p>加我微信（请备注姓名-公司），加入微信交流群，参与社区活动</p><p><img src="/img/jimmysong-wechat-tiny.jpg"></p>
      


            <a href="/contact" class="btn btn-small btn-template-main">跳到联系页面</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright ©️ 2018, ServiceMesher all rights reserved.</p>
            
            
            <p class="pull-left">&nbsp;<a href="http://www.miibeian.gov.cn/"> 京ICP备15032932号-5</a></p>
            
            <p class="pull-right">
              模板来自 <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              
              移植到 Hugo 来自 <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    <script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>
<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>

<script src="/js/prism.js"></script>


<script src="/js/algoliasearch.min.js"></script>
<script src="/js/autocomplete.min.js"></script>


  </body>
</html>
